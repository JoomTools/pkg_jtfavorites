/**
 * @package      Joomla.Administrator
 * @subpackage   mod_jtfavorites
 *
 * @author       Guido De Gobbis <support@joomtools.de>
 * @copyright    2020 JoomTools.de - All rights reserved.
 * @license      GNU General Public License version 3 or later
 */
var JtFavorites=window.JtFavorites||{};function modJtFavReady(e){"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)}!function(e,t){"use strict";e.sendData=function(e){var t=new XMLHttpRequest,n=new FormData(e);t.addEventListener("load",function(e){location.reload()}),t.addEventListener("error",function(e){console.error("mod_jtfavorites: Oops! Something went wrong on sending form data.")}),t.open("POST",e.getAttribute("action")),t.send(n)},e.submitform=function(n,a,r){a.addEventListener("submit",function(t){t.preventDefault(),e.sendData(a)}),n&&(a.task.value=n),a.noValidate=!r,r?a.hasAttribute("novalidate")&&a.removeAttribute("novalidate"):a.setAttribute("novalidate","");var i=t.createElement("input");i.style.display="none",i.type="submit",a.appendChild(i).click(),a.removeChild(i)},e.findAncestorForm=function(e){var n=e.match(/^[a-zA-Z]+/);return null!=n&&t.querySelector("#"+n.toString())},e.listItemTask=function(t,n){var a,r=e.findAncestorForm(t),i=0,o=r[t];if(!o)return!1;for(;a=r["cb"+i];)a.checked=!1,i++;o.checked=!0,r.boxchecked.value=1;var s=n.split(".",1);return r.setAttribute("action",r.getAttribute("data-"+s+"-action")),e.submitform(n,r),!1},e.changeListItemTask=function(){var e=t.querySelectorAll(".mod_jtfavorites *[onclick*=listItemTask]");Array.prototype.forEach.call(e,function(e){var t=e.getAttribute("onclick");e.setAttribute("onclick",t.replace("listItemTask","JtFavorites.listItemTask"))})},e.isExternal=function(e){return null!==e.match(/(http(s)?)?(\/)?\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g)},e.customActionsAddGetParams=function(){var n,a=t.querySelectorAll(".mod_jtfavorites .core .ext-link, .mod_jtfavorites .customs .ext-link"),r=t.querySelectorAll(".mod_jtfavorites .click-action a[onclick*=checkin]"),i=window.Joomla.getOptions("csrf.token",""),o=t.createElement("style"),s=t.createElement("span"),c=t.createElement("span"),l=t.createElement("span");o.setAttribute("type","text/css"),o.appendChild(t.createTextNode(".spinner {\n  display: inline-block;\n  height: 14px;\n  vertical-align: middle;\n  line-height: 18px;\n  margin-right: 4px;\n}\n.spinner > span {\n  background-color: #333;\n  margin-left: 2px;\n  height: 100%;\n  width: 3px;\n  display: inline-block;\n  -webkit-animation: sk-stretchdelay 1.2s infinite ease-in-out;\n  animation: sk-stretchdelay 1.2s infinite ease-in-out;\n}\n.spinner .rect2 {\n  -webkit-animation-delay: -1.1s;\n  animation-delay: -1.1s;\n}\n.spinner .rect3 {\n  -webkit-animation-delay: -1.0s;\n  animation-delay: -1.0s;\n}\n@-webkit-keyframes sk-stretchdelay {\n  0%, 40%, 100% { -webkit-transform: scaleY(0.4) }  \n  20% { -webkit-transform: scaleY(1.0) }\n}\n@keyframes sk-stretchdelay {\n  0%, 40%, 100% { \n    transform: scaleY(0.4);\n    -webkit-transform: scaleY(0.4);\n  }  20% { \n    transform: scaleY(1.0);\n    -webkit-transform: scaleY(1.0);\n  }\n}")),t.head.appendChild(o),s.setAttribute("class","spinner"),s.setAttribute("aria-hidden","true"),s.innerHTML='<span class="rect1"></span><span class="rect2"></span><span class="rect3"></span>',l.setAttribute("class","icon-save"),l.setAttribute("aria-hidden","true"),c.setAttribute("class","error"),c.setAttribute("aria-hidden","true"),Array.prototype.forEach.call(a,function(t){var a=t.getAttribute("href"),o=e.isExternal(a);console.log("isExternal: ",o),!0!==o&&t.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault(),t.parentNode.prepend(s),window.Joomla.request({url:a,headers:{"X-CSRF-Token":i},onError:function(e){console.error("ERROR: ",e)},onSuccess:function(e){var a;try{e=JSON.parse(e)}catch(t){e={success:!0}}t.parentNode.contains(s)&&t.parentNode.removeChild(s),!0===e.success&&(t.parentNode.prepend(l),t.parentNode.contains(c)&&t.parentNode.removeChild(c),a=l,n=!0),!1===e.success&&(console.error("ERROR: ",e.message),c.innerHTML='<span style="color:red;">'+e.message+"</span>",t.parentNode.appendChild(c),a=c,n=!1),Array.prototype.forEach.call(r,function(e){null!==e.parentNode&&e.parentNode.contains(e)&&e.parentNode.removeChild(e)}),n&&setTimeout(function(){t.parentNode.contains(a)&&t.parentNode.removeChild(a)},4e3)}})})})}}(JtFavorites,document),modJtFavReady(JtFavorites.changeListItemTask),modJtFavReady(JtFavorites.customActionsAddGetParams);